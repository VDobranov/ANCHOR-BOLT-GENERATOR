# ANCHOR-BOLT-GENERATOR

Генератор анкерных болтов (фундаментных болтов) по ГОСТ 24379.1-2012 с экспортом в IFC4 и 3D визуализацией в браузере.

## Обзор

Приложение позволяет:
✅ Создавать анкерные болты согласно ГОСТ 24379.1-2012
✅ Визуализировать болты в 3D с помощью Three.js
✅ Экспортировать результат в файл IFC (Industry Foundation Classes) для BIM
✅ Работает полностью в браузере (Python работает через Pyodide)
✅ Динамическое кэширование типов
✅ Полная валидация по ГОСТ

## Структура проекта

```
anchor-bolt-generator/
├── index.html              # Главная страница
├── style.css               # Стили
├── js/                     # JavaScript модули
│   ├── main.js            # Оркестрация (форма, события)
│   ├── viewer.js          # 3D визуализация (Three.js)
│   └── ifcBridge.js       # Мост JS ↔ Python (Pyodide)
├── python/                # Python модули (выполняются в браузере)
│   ├── main.py           # Инициализация IFC документа
│   ├── gost_data.py      # Справочники ГОСТ и валидация
│   ├── type_factory.py    # Кэширование типов
│   ├── material_manager.py # Материалы
│   ├── pset_manager.py    # Property Sets
│   ├── instance_factory.py # Инстансы и сборка
│   ├── geometry_builder.py # Геометрия (опционально)
│   ├── ifc_generator.py   # Экспорт IFC
│   └── requirements.txt
├── ai/                    # Планы архитектуры
│   └── CONSOLIDATED_PLAN.md
└── README.md
```

## Быстрый старт

### Локально

```bash
# 1. Запустить HTTP-сервер
python3 -m http.server 8000

# 2. Открыть в браузере
# http://localhost:8000
```

### Использование

1. Выберите тип болта (1.1, 1.2, 2.1 или 5)
2. Выберите исполнение (если применимо)
3. Выберите диаметр (М12-М100)
4. Введите длину (в пределах ГОСТ)
5. Выберите материал (09Г2С, ВСт3пс2 или 10Г2)
6. Отметьте опции (гайки, шайбы)
7. Нажмите "Сгенерировать"
8. Двигайте мышь для вращения 3D вида
9. Скачайте IFC файл

## Технические детали

### Архитектура

**Двухэтапная инициализация:**

1. **При загрузке** (один раз):
   - Загрузка Pyodide (~80 МБ)
   - Импорт Python модулей
   - Создание базовой IFC структуры (Project → Site → Building → Storey)
   - Инициализация кэша типов

2. **При генерации** (каждый запрос):
   - Валидация параметров
   - Получение или создание типов (кэшировано)
   - Создание инстансов с позициями
   - Генерация IFC-строки
   - Рендеринг 3D с Three.js

### Типизация IFC

**Иерархия:**
```
IfcProject
└── IfcSite
    └── IfcBuilding
        └── IfcBuildingStorey
            └── IfcMechanicalFastener (Assembly: ANCHORBOLT)
                ├── IfcMechanicalFastener (Stud)
                ├── IfcMechanicalFastener (Nut #1, опц.)
                ├── IfcMechanicalFastener (Washer #1, опц.)
                ├── IfcMechanicalFastener (Nut #2, опц.)
                └── IfcMechanicalFastener (Washer #2, опц.)
```

**Кэширование типов:**
- Ключ: `(тип, диаметр, длина, исполнение, материал)`
- Один раз созданный тип переиспользуется
- Оптимизирует размер IFC файла

### GOST справочники

**Поддерживаемые типы болтов:**

| Тип | Категория | Форма | Исполнения | Диаметры | Длины |
|-----|----------|-------|-----------|---------|-------|
| 1.1 | I         | Изогнутый | 1, 2 | All | 400-1600 |
| 1.2 | I         | Изогнутый | 1, 2 | All | 400-1000 |
| 2.1 | II        | Прямой | 1 | All | 500-1250 |
| 5   | -         | Футорка | 1 | All | 500-1000 |

**Доступные диаметры:**
М12, М16, М20, М24, М30, М36, М42, М48, М56, М64, М72, М80, М90, М100

**Материалы (ГОСТ):**
- 09Г2С (ГОСТ 19281-2014) - σ_в = 490 МПа
- ВСт3пс2 (ГОСТ 535-88) - σ_в = 345 МПа
- 10Г2 (ГОСТ 19281-2014) - σ_в = 490 МПа

## Технологии

| Компонент | Версия | Назначение |
|-----------|--------|-----------|
| HTML/CSS/JS | HTML5 | Frontend |
| Three.js | r128 | 3D визуализация |
| Pyodide | 0.23.4 | Python runtime в браузере |
| IfcOpenShell | 0.8.4 | Работа с IFC |
| IFC Standard | IFC4 ADD2 TC1 | Формат файлов |
| Python | 3.11+ | Логика IFC |

## API

### JavaScript

```javascript
// Инициализация
const bridge = await initializeIFCBridge();

// Генерация болта
const result = await bridge.generateBolt({
    bolt_type: '1.1',
    execution: 1,
    diameter: 20,
    length: 800,
    material: '09Г2С',
    has_bottom_nut: true,
    has_top_nut: true,
    has_washers: true
});

// result.ifcData - IFC-строка для скачивания
// result.meshData - данные для 3D визуализации
```

### Python

```python
# Инициализация
from main import initialize_base_document, get_ifc_document
ifc_doc = initialize_base_document()

# Генерация болта
from instance_factory import generate_bolt_assembly
ifc_str, mesh_data = generate_bolt_assembly({
    'bolt_type': '1.1',
    'execution': 1,
    'diameter': 20,
    'length': 800,
    'material': '09Г2С',
    'has_bottom_nut': True,
    'has_top_nut': True,
    'has_washers': True
})
```

## Примеры

### Пример 1: Простая шпилька

```
Тип: 1.1, Исполнение: 1
Диаметр: М20, Длина: 800 мм
Материал: 09Г2С
Компоненты: только шпилька
```

### Пример 2: Полная сборка с гайками и шайбами

```
Тип: 1.1, Исполнение: 1
Диаметр: М20, Длина: 800 мм
Материал: 09Г2С
Компоненты: ✓ шпилька ✓ 2 гайки ✓ 2 шайбы
```

## Статус разработки

| Этап | Статус | Описание |
|------|--------|---------|
| 1.  Инфраструктура | ✅ Готово | HTML, CSS, JS основа, Pyodide |
| 2. GOST справочники | ✅ Готово | gost_data.py с полными таблицами |
| 3. Geometry Builder | ✅ Готово | Построение кривых и профилей |
| 4. Type Factory | ✅ Готово | Кэширование типов |
| 5. Materials & PSets | ✅ Готово | Материалы и свойства |
| 6. Instance Factory | ✅ Готово | Создание инстансов и сборка |
| 7. IFC Generator | ✅ Готово | Экспорт в IFC |
| 8. Интеграция | ⏳ В процессе | Полная JS/Python интеграция |
| 9. Тестирование | ⏳ Планируется | Валидация, примеры |
| 10. Документация | ⏳ Планируется | API docs, примеры |

## Известные ограничения

1. **Pyodide совместимость** - некоторые сложные примитивы IFC могут требовать упрощения
2. **Производительность** - первая загрузка Pyodide займет 2-3 сек
3. **Браузер** - требует современный браузер с WebGL поддержкой
4. **Памяти** - большие сборки могут потребовать больше памяти

## Развитие

Планируемые фич:
- [ ] Добавить все остальные типы болтов из ГОСТ
- [ ] Поддержка импорта параметров из CSV/JSON
- [ ] Пакетная генерация болтов
- [ ] Экспорт в другие форматы (STEP, STL)
- [ ] Совместимость с популярными BIM приложениями (Revit, ArchiCAD)
- [ ] Настройка размеров гаек/шайб
- [ ] История генерации

## Лицензия

MIT

## Дополнительные ресурсы

- **ГОСТ 24379.1-2012** - Болты фундаментные анкерные
- **IFC4 ADD2 TC1** - Стандарт информационного моделирования зданий
- **Three.js** - JavaScript 3D библиотека
- **Pyodide** - Python в браузере

## Контакты

Разработано с помощью Claude Haiku 4.5 AI assistant
