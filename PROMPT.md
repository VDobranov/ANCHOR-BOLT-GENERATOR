# PROMPT

Разработай детальный план создания одностраничного статического веб-приложения на Python, которое генерирует параметрическую IFC-модель фундаментных болтов по ГОСТ 24379.1-2012 на основе входных данных, вводимых пользователем.

## Технические требования

### 1. Окружение и технологии

- Язык: Python
- Выполнение в браузере: Pyodide
- Библиотека для работы с IFC: IfcOpenShell
- Визуализация 3D: Three.js
- Фреймворк: без использования (чистый HTML/CSS/JS)

### 2. Функциональные требования

- Пользователь вводит параметры болта согласно ГОСТ 24379.1-2012 (тип, исполнение, диаметр, длина, наличие дополнительных гаек или шайб и т.д.);
- Доступные типы болтов для выбора: 1 (исполнения 1, 2), 2 (исполнение 1), 5;
- Номера позиций шпилек в зависимости от типа и исполнения болта: для 1.1 — 1, для 1.2 — 2, для 2.1 — 3, для 5 — 7;
- Отображается 3D-предпросмотр модели с возможностью вращения, зума, выбора элементов;
- Отображаются свойства либо всего болта, либо выбранного в данный момент элемента;
- Пользователь может контролировать стандартные Property Sets (PSets), которые заполняются автоматически;
- Приложение генерирует и позволяет скачать валидный IFC-файл.

### 3. Архитектурные требования к модели

#### 3.0 IFC

- Версия: IFC4.0.2.1 / IFC4 ADD2 TC1 официально принятая в РФ;
- Для всех элементов должны быть созданы типы (подклассы IfcElementType), вся геометрия, все свойства должны наследоваться элементами от своих типов.

#### 3.1. Иерархия элементов

- **Архитектура типов**: Все элементы сборки определяются типами (IfcMechanicalFastenerType для каждой категории), которые содержат полную геометрию, свойства и стандартные параметры.
- **Инстансы элементов**: Физически создаются соответствующие инстансы (IfcMechanicalFastener) с установленными ссылками на свои типы через атрибут `IsTypedBy` (отношение IfcRelDefinesByType).
- **Наследование**: Всякий экземпляр наследует от своего типа геометрию, материальные свойства и значения Property Sets, переопределяя только локально-специфичные атрибуты (например, положение в пространстве через IfcObjectPlacement).
- **Типы в модели**:
  - **IfcMechanicalFastenerType** для шпильки (USERDEFINED, ElementType "STUD")
  - **IfcMechanicalFastenerType** для гаек (USERDEFINED, ElementType "NUT")
  - **IfcMechanicalFastenerType** для шайб (USERDEFINED, ElementType "WASHER")
  - **IfcMechanicalFastenerType** для сборки (PredefinedType "ANCHORBOLT")
- **Преимущества подхода**: Единая точка определения параметров, снижение объёма данных в файле, упрощённое управление версионированием типов.

#### 3.2. Геометрия

- Шпилька: единый элемент **IfcSweptDiskSolid** (не несколько сегментов)
  - **Осевая линия** строится как составная кривая (**IfcCompositeCurve**) из следующих элементов:
    - **IfcLine** — прямолинейные сегменты (нижний участок шпильки)
    - **IfcCircularArcSegment3D** или **IfcCircularArc** — дугообразный сегмент для изогнутых болтов (переходной изгиб)
    - **IfcLine** — верхний прямолинейный сегмент шпильки
    - Все сегменты кривой связаны через IfcCompositeCurve с корректной ориентацией (SelfIntersect = FALSE)
  - **Радиус диска** = диаметр резьбы / 2 (определяется через IfcCircleProfileDef)
- Гайки и шайбы: **IfcExtrudedAreaSolid** с профилем **IfcArbitraryProfileDefWithVoids**
  - **Гайка**: 
    - Внешний контур: **IfcPolyline** с 6 вершинами (шестиугольный профиль)
    - Внутреннее отверстие: **IfcCircleProfileDef** (круглое отверстие под резьбу)
    - Профиль: **IfcArbitraryProfileDefWithVoids** = IfcPolyline(внешний) + [IfcCircleProfileDef(внутренний)]
  - **Шайба**:
    - Внешний контур: **IfcCircleProfileDef** (внешний диаметр шайбы)
    - Внутреннее отверстие: **IfcCircleProfileDef** (центральное отверстие под резьбу)
    - Профиль: **IfcArbitraryProfileDefWithVoids** = IfcCircleProfileDef(внешний) + [IfcCircleProfileDef(внутренний)]
  - Высота выдавливания = высота гайки или толщина шайбы соответственно

#### 3.3. Отношения между элементами

- Агрегация: **IfcRelAggregates** (главный болт → компоненты)
- Соединения: **IfcRelConnectsElements** (шпилька ↔ гайки/шайбы)

#### 3.4. Свойства

- **Определение на уровне типов**: Все базовые свойства и параметры определяются в типах (IfcMechanicalFastenerType) и являются общими для всех инстансов данного типа.
- **Стандартные атрибуты типов**:
  - `Name` (имя элемента):
    - Для сборки: "Болт {тип}.{исполнение}.М{диаметр} х {длина} {марка стали} ГОСТ 24379.1-2012". Например, "Болт 1.1.М20 х 800 ВСт3пс2 ГОСТ 24379.1-2012";
    - Для шпильки: "Шпилька {позиция}.М{диаметр} х {длина} {марка стали} ГОСТ 24379.1-2012". Например, "Шпилька 1.М20 х 800 ВСтЗпс2 ГОСТ 24379.1-2012;
    - Для гаек: "Гайка М{диаметр} ГОСТ 5915-70". Например, "Гайка М48 ГОСТ 5915-70";
    - Для шайб: "Шайба М{диаметр} ГОСТ 24379.1-2012". Например, "Шайба М48 ГОСТ 24379.1-2012".
  - `NominalDiameter` (диаметр резьбы)
  - `NominalLength` (номинальная длина)
  - `ElementType` (строковый идентификатор): "STUD", "NUT", "WASHER"
  - `PredefinedType`: для шпильки, гаек, шайб — "USERDEFINED"; для сборки — "ANCHORBOLT"
- **Инстансы наследуют свойства**: Каждый инстанс (IfcMechanicalFastener) наследует параметры от своего типа и добавляет только локальные данные (положение, ориентация через IfcObjectPlacement и IfcProductDefinitionShape).
- **Property Sets (PSets)**: Определяются в типах, применяются ко всем инстансам через отношение IfcRelDefinesByType:
  - Pset_MechanicalFastenerCommon (для всех элементов):
    - NominalDiameter - для всех элементов;
    - NominalLengthNominalLength - для шпильки и сборки.
  - Pset_ElementComponentCommon (для сборки):
    - CorrosionTreatment - "GALVANISED";
    - DeliveryType - "LOOSE";
    - Status - "NEW".
  - Pset_ManufacturerTypeInformation (для сборки):
    - AssemblyPlace — "SITE";
    - ModelLabel - {Значение Name у сборки};
    - OperationalDocument - "ГОСТ 24379.1-2012".
  - Pset_MechanicalFastenerAnchorBolt (для сборки):
    - AnchorBoltLength;
    - AnchorBoltDiameter;
    - AnchorBoltThreadLength;
    - AnchorBoltProtrusionLength - равна AnchorBoltThreadLength.
- **Переопределение свойств**: Значения могут быть переопределены на уровне инстанса при необходимости через IfcPropertySet с отношением IfcRelDefinesByProperties.

#### 3.5. Материалы

- Материал определяется на уровне типа (IfcMechanicalFastenerType) и наследуется всеми инстансами данного типа;
- Для всех элементов используется один и тот же материал (например, сталь);
- Материал задаётся через класс IfcMaterial и связывается с типом через IfcRelAssociatesMaterial;
- Все материалы, доступные для выбора пользователем, — по ГОСТ 19281-2014;
- Материал по умолчанию — 09Г2С:
  - `Name`: "09Г2С";
  - `Description`: "Сталь 09Г2С по ГОСТ 19281-2014";
  - `MaterialType`: "STEEL".

### 4. Требования к структуре ответа

Представь ответ в виде детального плана с разделами:

1. **Архитектура сборки** — иерархия типов и инстансов IFC с диаграммой
2. **Структура проекта** — дерево файлов и папок
3. **Спецификация IfcMechanicalFastenerType** — таблица атрибутов типов и их назначение
4. **Создание типов элементов** (определяется один раз при инициализации):
   - Построение осевой линии — код для конструирования IfcCompositeCurve (IfcLine + IfcCircularArc)
   - Тип шпильки (IfcMechanicalFastenerType, ElementType "STUD") — геометрия IfcSweptDiskSolid, Property Sets
   - Профили для гаек и шайб — построение IfcArbitraryProfileDefWithVoids (внешний контур + внутреннее отверстие)
   - Тип гаек (IfcMechanicalFastenerType, ElementType "NUT") — геометрия IfcExtrudedAreaSolid, Property Sets
   - Тип шайб (IfcMechanicalFastenerType, ElementType "WASHER") — геометрия IfcExtrudedAreaSolid, Property Sets
   - Тип сборки (IfcMechanicalFastenerType, PredefinedType "ANCHORBOLT") — Property Sets
5. **Генерация инстансов элементов** (размещение в модели):
   - Инстанс шпильки (IfcMechanicalFastener) — размещение в пространстве (IfcObjectPlacement), ссылка на тип via IfcRelDefinesByType
   - Инстансы гаек (IfcMechanicalFastener) — размещение, ссылка на тип
   - Инстансы шайб (IfcMechanicalFastener) — размещение, ссылка на тип
   - Главный инстанс сборки (IfcMechanicalFastener) — размещение, ссылка на тип, ссылка на компоненты via IfcRelAggregates
6. **Отношения между инстансами** — IfcRelAggregates (главный → компоненты), IfcRelConnectsElements (связи между элементами), IfcRelDefinesByType (инстансы → типы)
7. **Интеграция с интерфейсом** — примеры вызова из JavaScript с передачей параметров болта
8. **Визуализация** — код для 3D-предпросмотра в браузере
9. **Структура данных ГОСТ** — примеры справочников параметров по ГОСТ 24379.1-2012
10. **План реализации** — таблица этапов с сроками
11. **Итоговая структура IFC-файла** — пример фрагмента .ifc с типами, инстансами и отношениями
12. **Преимущества архитектуры** — таблица преимуществ типо-инстансного подхода

### 5. Дополнительные требования

- Все примеры кода должны быть разделены на два этапа:
  - **Этап типизации** — создание типов (IfcMechanicalFastenerType) с геометрией и свойствами (выполняется один раз)
  - **Этап генерации** — создание инстансов (IfcMechanicalFastener) с размещением в пространстве и связью с типами (выполняется для каждого болта)
- Примеры кода на Python (для Pyodide) и JavaScript
- Укажи конкретные классы IfcOpenShell и их атрибуты для каждого типа элемента
- В примерах кода явно покажи создание IfcRelDefinesByType для связи инстансов с их типами
- Приведи примеры значений параметров по ГОСТ 24379.1-2012 (диаметры, длины, высоты гаек и шайб)
- Укажи схему IFC: IFC4.0.2.1 / IFC4 ADD2 TC1
- Учитывай ограничения работы в браузере (размер модели, производительность)
- Для 3D-предпросмотра предложи метод конвертации параметрических примитивов IFC в меш (например, через библиотеку IfcOpenShell)